(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[653],{760:(t,e,i)=>{"use strict";i.d(e,{N:()=>w});var s=i(5155),n=i(2115),r=i(869),o=i(2885),a=i(7494),h=i(845),l=i(1508);class d extends n.Component{getSnapshotBeforeUpdate(t){let e=this.props.childRef.current;if(e&&t.isPresent&&!this.props.isPresent){let t=e.offsetParent,i=t instanceof HTMLElement&&t.offsetWidth||0,s=this.props.sizeRef.current;s.height=e.offsetHeight||0,s.width=e.offsetWidth||0,s.top=e.offsetTop,s.left=e.offsetLeft,s.right=i-s.width-s.left}return null}componentDidUpdate(){}render(){return this.props.children}}function g(t){let{children:e,isPresent:i,anchorX:r}=t,o=(0,n.useId)(),a=(0,n.useRef)(null),h=(0,n.useRef)({width:0,height:0,top:0,left:0,right:0}),{nonce:g}=(0,n.useContext)(l.Q);return(0,n.useInsertionEffect)(()=>{let{width:t,height:e,top:s,left:n,right:l}=h.current;if(i||!a.current||!t||!e)return;a.current.dataset.motionPopId=o;let d=document.createElement("style");return g&&(d.nonce=g),document.head.appendChild(d),d.sheet&&d.sheet.insertRule('\n          [data-motion-pop-id="'.concat(o,'"] {\n            position: absolute !important;\n            width: ').concat(t,"px !important;\n            height: ").concat(e,"px !important;\n            ").concat("left"===r?"left: ".concat(n):"right: ".concat(l),"px !important;\n            top: ").concat(s,"px !important;\n          }\n        ")),()=>{document.head.removeChild(d)}},[i]),(0,s.jsx)(d,{isPresent:i,childRef:a,sizeRef:h,children:n.cloneElement(e,{ref:a})})}let p=t=>{let{children:e,initial:i,isPresent:r,onExitComplete:a,custom:l,presenceAffectsLayout:d,mode:p,anchorX:u}=t,f=(0,o.M)(c),m=(0,n.useId)(),w=(0,n.useCallback)(t=>{for(let e of(f.set(t,!0),f.values()))if(!e)return;a&&a()},[f,a]),y=(0,n.useMemo)(()=>({id:m,initial:i,isPresent:r,custom:l,onExitComplete:w,register:t=>(f.set(t,!1),()=>f.delete(t))}),d?[Math.random(),w]:[r,w]);return(0,n.useMemo)(()=>{f.forEach((t,e)=>f.set(e,!1))},[r]),n.useEffect(()=>{r||f.size||!a||a()},[r]),"popLayout"===p&&(e=(0,s.jsx)(g,{isPresent:r,anchorX:u,children:e})),(0,s.jsx)(h.t.Provider,{value:y,children:e})};function c(){return new Map}var u=i(2082);let f=t=>t.key||"";function m(t){let e=[];return n.Children.forEach(t,t=>{(0,n.isValidElement)(t)&&e.push(t)}),e}let w=t=>{let{children:e,custom:i,initial:h=!0,onExitComplete:l,presenceAffectsLayout:d=!0,mode:g="sync",propagate:c=!1,anchorX:w="left"}=t,[y,x]=(0,u.xQ)(c),P=(0,n.useMemo)(()=>m(e),[e]),v=c&&!y?[]:P.map(f),b=(0,n.useRef)(!0),S=(0,n.useRef)(P),C=(0,o.M)(()=>new Map),[E,I]=(0,n.useState)(P),[T,L]=(0,n.useState)(P);(0,a.E)(()=>{b.current=!1,S.current=P;for(let t=0;t<T.length;t++){let e=f(T[t]);v.includes(e)?C.delete(e):!0!==C.get(e)&&C.set(e,!1)}},[T,v.length,v.join("-")]);let D=[];if(P!==E){let t=[...P];for(let e=0;e<T.length;e++){let i=T[e],s=f(i);v.includes(s)||(t.splice(e,0,i),D.push(i))}return"wait"===g&&D.length&&(t=D),L(m(t)),I(P),null}let{forceRender:O}=(0,n.useContext)(r.L);return(0,s.jsx)(s.Fragment,{children:T.map(t=>{let e=f(t),n=(!c||!!y)&&(P===T||v.includes(e));return(0,s.jsx)(p,{isPresent:n,initial:(!b.current||!!h)&&void 0,custom:i,presenceAffectsLayout:d,mode:g,onExitComplete:n?void 0:()=>{if(!C.has(e))return;C.set(e,!0);let t=!0;C.forEach(e=>{e||(t=!1)}),t&&(null==O||O(),L(S.current),c&&(null==x||x()),l&&l())},anchorX:w,children:t},e)})})}},1616:t=>{"use strict";t.exports=function t(e,i){if(e===i)return!0;if(e&&i&&"object"==typeof e&&"object"==typeof i){if(e.constructor!==i.constructor)return!1;if(Array.isArray(e)){if((s=e.length)!=i.length)return!1;for(n=s;0!=n--;)if(!t(e[n],i[n]))return!1;return!0}if(e.constructor===RegExp)return e.source===i.source&&e.flags===i.flags;if(e.valueOf!==Object.prototype.valueOf)return e.valueOf()===i.valueOf();if(e.toString!==Object.prototype.toString)return e.toString()===i.toString();if((s=(r=Object.keys(e)).length)!==Object.keys(i).length)return!1;for(n=s;0!=n--;)if(!Object.prototype.hasOwnProperty.call(i,r[n]))return!1;for(n=s;0!=n--;){var s,n,r,o=r[n];if(!t(e[o],i[o]))return!1}return!0}return e!=e&&i!=i}},4436:(t,e,i)=>{"use strict";i.d(e,{k5:()=>d});var s=i(2115),n={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},r=s.createContext&&s.createContext(n),o=["attr","size","title"];function a(){return(a=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(t[s]=i[s])}return t}).apply(this,arguments)}function h(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),i.push.apply(i,s)}return i}function l(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?h(Object(i),!0).forEach(function(e){var s,n,r;s=t,n=e,r=i[e],(n=function(t){var e=function(t,e){if("object"!=typeof t||!t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var s=i.call(t,e||"default");if("object"!=typeof s)return s;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:e+""}(n))in s?Object.defineProperty(s,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):s[n]=r}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):h(Object(i)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))})}return t}function d(t){return e=>s.createElement(g,a({attr:l({},t.attr)},e),function t(e){return e&&e.map((e,i)=>s.createElement(e.tag,l({key:i},e.attr),t(e.child)))}(t.child))}function g(t){var e=e=>{var i,{attr:n,size:r,title:h}=t,d=function(t,e){if(null==t)return{};var i,s,n=function(t,e){if(null==t)return{};var i={};for(var s in t)if(Object.prototype.hasOwnProperty.call(t,s)){if(e.indexOf(s)>=0)continue;i[s]=t[s]}return i}(t,e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);for(s=0;s<r.length;s++)i=r[s],!(e.indexOf(i)>=0)&&Object.prototype.propertyIsEnumerable.call(t,i)&&(n[i]=t[i])}return n}(t,o),g=r||e.size||"1em";return e.className&&(i=e.className),t.className&&(i=(i?i+" ":"")+t.className),s.createElement("svg",a({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},e.attr,n,d,{className:i,style:l(l({color:t.color||e.color},e.style),t.style),height:g,width:g,xmlns:"http://www.w3.org/2000/svg"}),h&&s.createElement("title",null,h),t.children)};return void 0!==r?s.createElement(r.Consumer,null,t=>e(t)):e(n)}},6145:(t,e,i)=>{"use strict";i.d(e,{A:()=>o});var s=i(2115),n=i(6853);let r=s.forwardRef((t,e)=>{let i=(0,s.useRef)(null),r=(0,s.useRef)([]),o=(0,s.useRef)(),[a,h]=(0,s.useState)([]);(0,s.useImperativeHandle)(e,()=>({pageFlip:()=>o.current}));let l=(0,s.useCallback)(()=>{o.current&&o.current.clear()},[]),d=(0,s.useCallback)(()=>{let t=o.current;t&&(t.off("flip"),t.off("changeOrientation"),t.off("changeState"),t.off("init"),t.off("update"))},[]);return(0,s.useEffect)(()=>{if(r.current=[],t.children){let e=s.Children.map(t.children,t=>s.cloneElement(t,{ref:t=>{t&&r.current.push(t)}}));t.renderOnlyPageLengthChange&&a.length===e.length||(e.length<a.length&&l(),h(e))}},[t.children]),(0,s.useEffect)(()=>{a.length>0&&r.current.length>0&&(d(),i.current&&!o.current&&(o.current=new n.PageFlip(i.current,t)),o.current.getFlipController()?o.current.updateFromHtml(r.current):o.current.loadFromHTML(r.current),(()=>{let e=o.current;e&&(t.onFlip&&e.on("flip",e=>t.onFlip(e)),t.onChangeOrientation&&e.on("changeOrientation",e=>t.onChangeOrientation(e)),t.onChangeState&&e.on("changeState",e=>t.onChangeState(e)),t.onInit&&e.on("init",e=>t.onInit(e)),t.onUpdate&&e.on("update",e=>t.onUpdate(e)))})())},[a]),s.createElement("div",{ref:i,className:t.className,style:t.style},a)}),o=s.memo(r)},6853:function(t,e){!function(t){"use strict";class e{constructor(t,e){this.state={angle:0,area:[],position:{x:0,y:0},hardAngle:0,hardDrawingAngle:0},this.createdDensity=e,this.nowDrawingDensity=this.createdDensity,this.render=t}setDensity(t){this.createdDensity=t,this.nowDrawingDensity=t}setDrawingDensity(t){this.nowDrawingDensity=t}setPosition(t){this.state.position=t}setAngle(t){this.state.angle=t}setArea(t){this.state.area=t}setHardDrawingAngle(t){this.state.hardDrawingAngle=t}setHardAngle(t){this.state.hardAngle=t,this.state.hardDrawingAngle=t}setOrientation(t){this.orientation=t}getDrawingDensity(){return this.nowDrawingDensity}getDensity(){return this.createdDensity}getHardAngle(){return this.state.hardAngle}}class i extends e{constructor(t,e,i){super(t,i),this.image=null,this.isLoad=!1,this.loadingAngle=0,this.image=new Image,this.image.src=e}draw(t){let e=this.render.getContext(),i=this.render.convertToGlobal(this.state.position),s=this.render.getRect().pageWidth,n=this.render.getRect().height;for(let t of(e.save(),e.translate(i.x,i.y),e.beginPath(),this.state.area))null!==t&&(t=this.render.convertToGlobal(t),e.lineTo(t.x-i.x,t.y-i.y));e.rotate(this.state.angle),e.clip(),this.isLoad?e.drawImage(this.image,0,0,s,n):this.drawLoader(e,{x:0,y:0},s,n),e.restore()}simpleDraw(t){let e=this.render.getRect(),i=this.render.getContext(),s=e.pageWidth,n=e.height,r=1===t?e.left+e.pageWidth:e.left,o=e.top;this.isLoad?i.drawImage(this.image,r,o,s,n):this.drawLoader(i,{x:r,y:o},s,n)}drawLoader(t,e,i,s){t.beginPath(),t.strokeStyle="rgb(200, 200, 200)",t.fillStyle="rgb(255, 255, 255)",t.lineWidth=1,t.rect(e.x+1,e.y+1,i-1,s-1),t.stroke(),t.fill();let n={x:e.x+i/2,y:e.y+s/2};t.beginPath(),t.lineWidth=10,t.arc(n.x,n.y,20,this.loadingAngle,3*Math.PI/2+this.loadingAngle),t.stroke(),t.closePath(),this.loadingAngle+=.07,this.loadingAngle>=2*Math.PI&&(this.loadingAngle=0)}load(){this.isLoad||(this.image.onload=()=>{this.isLoad=!0})}newTemporaryCopy(){return this}getTemporaryCopy(){return this}hideTemporaryCopy(){}}class s{constructor(t,e){this.pages=[],this.currentPageIndex=0,this.currentSpreadIndex=0,this.landscapeSpread=[],this.portraitSpread=[],this.render=e,this.app=t,this.currentPageIndex=0,this.isShowCover=this.app.getSettings().showCover}destroy(){this.pages=[]}createSpread(){this.landscapeSpread=[],this.portraitSpread=[];for(let t=0;t<this.pages.length;t++)this.portraitSpread.push([t]);let t=0;this.isShowCover&&(this.pages[0].setDensity("hard"),this.landscapeSpread.push([t]),t++);for(let e=t;e<this.pages.length;e+=2)e<this.pages.length-1?this.landscapeSpread.push([e,e+1]):(this.landscapeSpread.push([e]),this.pages[e].setDensity("hard"))}getSpread(){return"landscape"===this.render.getOrientation()?this.landscapeSpread:this.portraitSpread}getSpreadIndexByPage(t){let e=this.getSpread();for(let i=0;i<e.length;i++)if(t===e[i][0]||t===e[i][1])return i;return null}getPageCount(){return this.pages.length}getPages(){return this.pages}getPage(t){if(t>=0&&t<this.pages.length)return this.pages[t];throw Error("Invalid page number")}nextBy(t){let e=this.pages.indexOf(t);return e<this.pages.length-1?this.pages[e+1]:null}prevBy(t){let e=this.pages.indexOf(t);return e>0?this.pages[e-1]:null}getFlippingPage(t){let e=this.currentSpreadIndex;if("portrait"===this.render.getOrientation())return 0===t?this.pages[e].newTemporaryCopy():this.pages[e-1];{let i=0===t?this.getSpread()[e+1]:this.getSpread()[e-1];return 1===i.length||0===t?this.pages[i[0]]:this.pages[i[1]]}}getBottomPage(t){let e=this.currentSpreadIndex;if("portrait"===this.render.getOrientation())return 0===t?this.pages[e+1]:this.pages[e-1];{let i=0===t?this.getSpread()[e+1]:this.getSpread()[e-1];return 1===i.length?this.pages[i[0]]:0===t?this.pages[i[1]]:this.pages[i[0]]}}showNext(){this.currentSpreadIndex<this.getSpread().length&&(this.currentSpreadIndex++,this.showSpread())}showPrev(){this.currentSpreadIndex>0&&(this.currentSpreadIndex--,this.showSpread())}getCurrentPageIndex(){return this.currentPageIndex}show(t=null){if(null===t&&(t=this.currentPageIndex),t<0||t>=this.pages.length)return;let e=this.getSpreadIndexByPage(t);null!==e&&(this.currentSpreadIndex=e,this.showSpread())}getCurrentSpreadIndex(){return this.currentSpreadIndex}setCurrentSpreadIndex(t){if(!(t>=0&&t<this.getSpread().length))throw Error("Invalid page");this.currentSpreadIndex=t}showSpread(){let t=this.getSpread()[this.currentSpreadIndex];2===t.length?(this.render.setLeftPage(this.pages[t[0]]),this.render.setRightPage(this.pages[t[1]])):"landscape"===this.render.getOrientation()&&t[0]===this.pages.length-1?(this.render.setLeftPage(this.pages[t[0]]),this.render.setRightPage(null)):(this.render.setLeftPage(null),this.render.setRightPage(this.pages[t[0]])),this.currentPageIndex=t[0],this.app.updatePageIndex(this.currentPageIndex)}}class n extends s{constructor(t,e,i){super(t,e),this.imagesHref=i}load(){for(let t of this.imagesHref){let e=new i(this.render,t,"soft");e.load(),this.pages.push(e)}this.createSpread()}}class r{static GetDistanceBetweenTwoPoint(t,e){return null===t||null===e?1/0:Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))}static GetSegmentLength(t){return r.GetDistanceBetweenTwoPoint(t[0],t[1])}static GetAngleBetweenTwoLine(t,e){let i=t[0].y-t[1].y,s=e[0].y-e[1].y,n=t[1].x-t[0].x,r=e[1].x-e[0].x;return Math.acos((i*s+n*r)/(Math.sqrt(i*i+n*n)*Math.sqrt(s*s+r*r)))}static PointInRect(t,e){return null===e?null:e.x>=t.left&&e.x<=t.width+t.left&&e.y>=t.top&&e.y<=t.top+t.height?e:null}static GetRotatedPoint(t,e,i){return{x:t.x*Math.cos(i)+t.y*Math.sin(i)+e.x,y:t.y*Math.cos(i)-t.x*Math.sin(i)+e.y}}static LimitPointToCircle(t,e,i){if(r.GetDistanceBetweenTwoPoint(t,i)<=e)return i;let s=t.x,n=t.y,o=i.x,a=i.y,h=Math.sqrt(Math.pow(e,2)*Math.pow(s-o,2)/(Math.pow(s-o,2)+Math.pow(n-a,2)))+s;i.x<0&&(h*=-1);let l=(h-s)*(n-a)/(s-o)+n;return s-o+n===0&&(l=e),{x:h,y:l}}static GetIntersectBetweenTwoSegment(t,e,i){return r.PointInRect(t,r.GetIntersectBeetwenTwoLine(e,i))}static GetIntersectBeetwenTwoLine(t,e){let i=t[0].y-t[1].y,s=e[0].y-e[1].y,n=t[1].x-t[0].x,r=e[1].x-e[0].x,o=t[0].x*t[1].y-t[1].x*t[0].y,a=e[0].x*e[1].y-e[1].x*e[0].y,h=-(o*r-a*n)/(i*r-s*n),l=-(i*a-s*o)/(i*r-s*n);if(isFinite(h)&&isFinite(l))return{x:h,y:l};if(.1>Math.abs(i*a-s*o-(n*a-r*o)))throw Error("Segment included");return null}static GetCordsFromTwoPoint(t,e){let i=Math.abs(t.x-e.x),s=Math.abs(t.y-e.y),n=Math.max(i,s),r=[t];function o(t,e,i,s,n){return e>t?t+i/s*n:e<t?t-i/s*n:t}for(let a=1;a<=n;a+=1)r.push({x:o(t.x,e.x,i,n,a),y:o(t.y,e.y,s,n,a)});return r}}class o extends e{constructor(t,e,i){super(t,i),this.copiedElement=null,this.temporaryCopy=null,this.isLoad=!1,this.element=e,this.element.classList.add("stf__item"),this.element.classList.add("--"+i)}newTemporaryCopy(){return"hard"===this.nowDrawingDensity?this:(null===this.temporaryCopy&&(this.copiedElement=this.element.cloneNode(!0),this.element.parentElement.appendChild(this.copiedElement),this.temporaryCopy=new o(this.render,this.copiedElement,this.nowDrawingDensity)),this.getTemporaryCopy())}getTemporaryCopy(){return this.temporaryCopy}hideTemporaryCopy(){null!==this.temporaryCopy&&(this.copiedElement.remove(),this.copiedElement=null,this.temporaryCopy=null)}draw(t){let e=t||this.nowDrawingDensity,i=this.render.convertToGlobal(this.state.position),s=this.render.getRect().pageWidth,n=this.render.getRect().height;this.element.classList.remove("--simple");let r=`
            display: block;
            z-index: ${this.element.style.zIndex};
            left: 0;
            top: 0;
            width: ${s}px;
            height: ${n}px;
        `;"hard"===e?this.drawHard(r):this.drawSoft(i,r)}drawHard(t=""){let e=this.render.getRect().left+this.render.getRect().width/2,i=this.state.hardDrawingAngle,s=t+"\n                backface-visibility: hidden;\n                -webkit-backface-visibility: hidden;\n                clip-path: none;\n                -webkit-clip-path: none;\n            "+(0===this.orientation?`transform-origin: ${this.render.getRect().pageWidth}px 0; 
                   transform: translate3d(0, 0, 0) rotateY(${i}deg);`:`transform-origin: 0 0; 
                   transform: translate3d(${e}px, 0, 0) rotateY(${i}deg);`);this.element.style.cssText=s}drawSoft(t,e=""){let i="polygon( ";for(let t of this.state.area)if(null!==t){let e=1===this.render.getDirection()?{x:-t.x+this.state.position.x,y:t.y-this.state.position.y}:{x:t.x-this.state.position.x,y:t.y-this.state.position.y};i+=(e=r.GetRotatedPoint(e,{x:0,y:0},this.state.angle)).x+"px "+e.y+"px, "}i=i.slice(0,-2)+")";let s=e+`transform-origin: 0 0; clip-path: ${i}; -webkit-clip-path: ${i};`+(this.render.isSafari()&&0===this.state.angle?`transform: translate(${t.x}px, ${t.y}px);`:`transform: translate3d(${t.x}px, ${t.y}px, 0) rotate(${this.state.angle}rad);`);this.element.style.cssText=s}simpleDraw(t){let e=this.render.getRect(),i=e.pageWidth,s=e.height,n=1===t?e.left+e.pageWidth:e.left,r=e.top;this.element.classList.add("--simple"),this.element.style.cssText=`
            position: absolute; 
            display: block; 
            height: ${s}px; 
            left: ${n}px; 
            top: ${r}px; 
            width: ${i}px; 
            z-index: ${this.render.getSettings().startZIndex+1};`}getElement(){return this.element}load(){this.isLoad=!0}setOrientation(t){super.setOrientation(t),this.element.classList.remove("--left","--right"),this.element.classList.add(1===t?"--right":"--left")}setDrawingDensity(t){this.element.classList.remove("--soft","--hard"),this.element.classList.add("--"+t),super.setDrawingDensity(t)}}class a extends s{constructor(t,e,i,s){super(t,e),this.element=i,this.pagesElement=s}load(){for(let t of this.pagesElement){let e=new o(this.render,t,"hard"===t.dataset.density?"hard":"soft");e.load(),this.pages.push(e)}this.createSpread()}}class h{constructor(t,e,i,s){this.direction=t,this.corner=e,this.topIntersectPoint=null,this.sideIntersectPoint=null,this.bottomIntersectPoint=null,this.pageWidth=parseInt(i,10),this.pageHeight=parseInt(s,10)}calc(t){try{return this.position=this.calcAngleAndPosition(t),this.calculateIntersectPoint(this.position),!0}catch(t){return!1}}getFlippingClipArea(){let t=[],e=!1;return t.push(this.rect.topLeft),t.push(this.topIntersectPoint),null===this.sideIntersectPoint?e=!0:(t.push(this.sideIntersectPoint),null===this.bottomIntersectPoint&&(e=!1)),t.push(this.bottomIntersectPoint),(e||"bottom"===this.corner)&&t.push(this.rect.bottomLeft),t}getBottomClipArea(){let t=[];return t.push(this.topIntersectPoint),"top"===this.corner?t.push({x:this.pageWidth,y:0}):(null!==this.topIntersectPoint&&t.push({x:this.pageWidth,y:0}),t.push({x:this.pageWidth,y:this.pageHeight})),null!==this.sideIntersectPoint?r.GetDistanceBetweenTwoPoint(this.sideIntersectPoint,this.topIntersectPoint)>=10&&t.push(this.sideIntersectPoint):"top"===this.corner&&t.push({x:this.pageWidth,y:this.pageHeight}),t.push(this.bottomIntersectPoint),t.push(this.topIntersectPoint),t}getAngle(){return 0===this.direction?-this.angle:this.angle}getRect(){return this.rect}getPosition(){return this.position}getActiveCorner(){return 0===this.direction?this.rect.topLeft:this.rect.topRight}getDirection(){return this.direction}getFlippingProgress(){return Math.abs((this.position.x-this.pageWidth)/(2*this.pageWidth)*100)}getCorner(){return this.corner}getBottomPagePosition(){return 1===this.direction?{x:this.pageWidth,y:0}:{x:0,y:0}}getShadowStartPoint(){return"top"===this.corner?this.topIntersectPoint:null!==this.sideIntersectPoint?this.sideIntersectPoint:this.topIntersectPoint}getShadowAngle(){let t=r.GetAngleBetweenTwoLine(this.getSegmentToShadowLine(),[{x:0,y:0},{x:this.pageWidth,y:0}]);return 0===this.direction?t:Math.PI-t}calcAngleAndPosition(t){let e=t;if(this.updateAngleAndGeometry(e),1>Math.abs((e="top"===this.corner?this.checkPositionAtCenterLine(e,{x:0,y:0},{x:0,y:this.pageHeight}):this.checkPositionAtCenterLine(e,{x:0,y:this.pageHeight},{x:0,y:0})).x-this.pageWidth)&&1>Math.abs(e.y))throw Error("Point is too small");return e}updateAngleAndGeometry(t){this.angle=this.calculateAngle(t),this.rect=this.getPageRect(t)}calculateAngle(t){let e=this.pageWidth-t.x+1,i="bottom"===this.corner?this.pageHeight-t.y:t.y,s=2*Math.acos(e/Math.sqrt(i*i+e*e));i<0&&(s=-s);let n=Math.PI-s;if(!isFinite(s)||n>=0&&n<.003)throw Error("The G point is too small");return"bottom"===this.corner&&(s=-s),s}getPageRect(t){return"top"===this.corner?this.getRectFromBasePoint([{x:0,y:0},{x:this.pageWidth,y:0},{x:0,y:this.pageHeight},{x:this.pageWidth,y:this.pageHeight}],t):this.getRectFromBasePoint([{x:0,y:-this.pageHeight},{x:this.pageWidth,y:-this.pageHeight},{x:0,y:0},{x:this.pageWidth,y:0}],t)}getRectFromBasePoint(t,e){return{topLeft:this.getRotatedPoint(t[0],e),topRight:this.getRotatedPoint(t[1],e),bottomLeft:this.getRotatedPoint(t[2],e),bottomRight:this.getRotatedPoint(t[3],e)}}getRotatedPoint(t,e){return{x:t.x*Math.cos(this.angle)+t.y*Math.sin(this.angle)+e.x,y:t.y*Math.cos(this.angle)-t.x*Math.sin(this.angle)+e.y}}calculateIntersectPoint(t){let e={left:-1,top:-1,width:this.pageWidth+2,height:this.pageHeight+2};"top"===this.corner?(this.topIntersectPoint=r.GetIntersectBetweenTwoSegment(e,[t,this.rect.topRight],[{x:0,y:0},{x:this.pageWidth,y:0}]),this.sideIntersectPoint=r.GetIntersectBetweenTwoSegment(e,[t,this.rect.bottomLeft],[{x:this.pageWidth,y:0},{x:this.pageWidth,y:this.pageHeight}])):(this.topIntersectPoint=r.GetIntersectBetweenTwoSegment(e,[this.rect.topLeft,this.rect.topRight],[{x:0,y:0},{x:this.pageWidth,y:0}]),this.sideIntersectPoint=r.GetIntersectBetweenTwoSegment(e,[t,this.rect.topLeft],[{x:this.pageWidth,y:0},{x:this.pageWidth,y:this.pageHeight}])),this.bottomIntersectPoint=r.GetIntersectBetweenTwoSegment(e,[this.rect.bottomLeft,this.rect.bottomRight],[{x:0,y:this.pageHeight},{x:this.pageWidth,y:this.pageHeight}])}checkPositionAtCenterLine(t,e,i){let s=t,n=r.LimitPointToCircle(e,this.pageWidth,s);s!==n&&(s=n,this.updateAngleAndGeometry(s));let o=Math.sqrt(Math.pow(this.pageWidth,2)+Math.pow(this.pageHeight,2)),a=this.rect.bottomRight,h=this.rect.topLeft;if("bottom"===this.corner&&(a=this.rect.topRight,h=this.rect.bottomLeft),a.x<=0){let t=r.LimitPointToCircle(i,o,h);t!==s&&(s=t,this.updateAngleAndGeometry(s))}return s}getSegmentToShadowLine(){let t=this.getShadowStartPoint();return[t,t!==this.sideIntersectPoint&&null!==this.sideIntersectPoint?this.sideIntersectPoint:this.bottomIntersectPoint]}}class l{constructor(t,e){this.flippingPage=null,this.bottomPage=null,this.calc=null,this.state="read",this.render=t,this.app=e}fold(t){this.setState("user_fold"),null===this.calc&&this.start(t),this.do(this.render.convertToPage(t))}flip(t){if(this.app.getSettings().disableFlipByClick&&!this.isPointOnCorners(t)||(null!==this.calc&&this.render.finishAnimation(),!this.start(t)))return;let e=this.getBoundsRect();this.setState("flipping");let i=e.height/10,s="bottom"===this.calc.getCorner()?e.height-i:i,n="bottom"===this.calc.getCorner()?e.height:0;this.calc.calc({x:e.pageWidth-i,y:s}),this.animateFlippingTo({x:e.pageWidth-i,y:s},{x:-e.pageWidth,y:n},!0)}start(t){this.reset();let e=this.render.convertToBook(t),i=this.getBoundsRect(),s=this.getDirectionByPoint(e),n=e.y>=i.height/2?"bottom":"top";if(!this.checkDirection(s))return!1;try{if(this.flippingPage=this.app.getPageCollection().getFlippingPage(s),this.bottomPage=this.app.getPageCollection().getBottomPage(s),"landscape"===this.render.getOrientation()){if(1===s){let t=this.app.getPageCollection().nextBy(this.flippingPage);null!==t&&this.flippingPage.getDensity()!==t.getDensity()&&(this.flippingPage.setDrawingDensity("hard"),t.setDrawingDensity("hard"))}else{let t=this.app.getPageCollection().prevBy(this.flippingPage);null!==t&&this.flippingPage.getDensity()!==t.getDensity()&&(this.flippingPage.setDrawingDensity("hard"),t.setDrawingDensity("hard"))}}return this.render.setDirection(s),this.calc=new h(s,n,i.pageWidth.toString(10),i.height.toString(10)),!0}catch(t){return!1}}do(t){if(null!==this.calc&&this.calc.calc(t)){let t=this.calc.getFlippingProgress();this.bottomPage.setArea(this.calc.getBottomClipArea()),this.bottomPage.setPosition(this.calc.getBottomPagePosition()),this.bottomPage.setAngle(0),this.bottomPage.setHardAngle(0),this.flippingPage.setArea(this.calc.getFlippingClipArea()),this.flippingPage.setPosition(this.calc.getActiveCorner()),this.flippingPage.setAngle(this.calc.getAngle()),0===this.calc.getDirection()?this.flippingPage.setHardAngle(90*(200-2*t)/100):this.flippingPage.setHardAngle(-90*(200-2*t)/100),this.render.setPageRect(this.calc.getRect()),this.render.setBottomPage(this.bottomPage),this.render.setFlippingPage(this.flippingPage),this.render.setShadowData(this.calc.getShadowStartPoint(),this.calc.getShadowAngle(),t,this.calc.getDirection())}}flipToPage(t,e){let i=this.app.getPageCollection().getCurrentSpreadIndex(),s=this.app.getPageCollection().getSpreadIndexByPage(t);try{s>i&&(this.app.getPageCollection().setCurrentSpreadIndex(s-1),this.flipNext(e)),s<i&&(this.app.getPageCollection().setCurrentSpreadIndex(s+1),this.flipPrev(e))}catch(t){}}flipNext(t){this.flip({x:this.render.getRect().left+2*this.render.getRect().pageWidth-10,y:"top"===t?1:this.render.getRect().height-2})}flipPrev(t){this.flip({x:10,y:"top"===t?1:this.render.getRect().height-2})}stopMove(){if(null===this.calc)return;let t=this.calc.getPosition(),e=this.getBoundsRect(),i="bottom"===this.calc.getCorner()?e.height:0;t.x<=0?this.animateFlippingTo(t,{x:-e.pageWidth,y:i},!0):this.animateFlippingTo(t,{x:e.pageWidth,y:i},!1)}showCorner(t){if(!this.checkState("read","fold_corner"))return;let e=this.getBoundsRect(),i=e.pageWidth;if(this.isPointOnCorners(t)){if(null===this.calc){if(!this.start(t))return;this.setState("fold_corner"),this.calc.calc({x:i-1,y:1});let s="bottom"===this.calc.getCorner()?e.height-1:1,n="bottom"===this.calc.getCorner()?e.height-50:50;this.animateFlippingTo({x:i-1,y:s},{x:i-50,y:n},!1,!1)}else this.do(this.render.convertToPage(t))}else this.setState("read"),this.render.finishAnimation(),this.stopMove()}animateFlippingTo(t,e,i,s=!0){let n=r.GetCordsFromTwoPoint(t,e),o=[];for(let t of n)o.push(()=>this.do(t));let a=this.getAnimationDuration(n.length);this.render.startAnimation(o,a,()=>{this.calc&&(i&&(1===this.calc.getDirection()?this.app.turnToPrevPage():this.app.turnToNextPage()),s&&(this.render.setBottomPage(null),this.render.setFlippingPage(null),this.render.clearShadow(),this.setState("read"),this.reset()))})}getCalculation(){return this.calc}getState(){return this.state}setState(t){this.state!==t&&(this.app.updateState(t),this.state=t)}getDirectionByPoint(t){let e=this.getBoundsRect();if("portrait"===this.render.getOrientation()){if(t.x-e.pageWidth<=e.width/5)return 1}else if(t.x<e.width/2)return 1;return 0}getAnimationDuration(t){let e=this.app.getSettings().flippingTime;return t>=1e3?e:t/1e3*e}checkDirection(t){return 0===t?this.app.getCurrentPageIndex()<this.app.getPageCount()-1:this.app.getCurrentPageIndex()>=1}reset(){this.calc=null,this.flippingPage=null,this.bottomPage=null}getBoundsRect(){return this.render.getRect()}checkState(...t){for(let e of t)if(this.state===e)return!0;return!1}isPointOnCorners(t){let e=this.getBoundsRect(),i=Math.sqrt(Math.pow(e.pageWidth,2)+Math.pow(e.height,2))/5,s=this.render.convertToBook(t);return s.x>0&&s.y>0&&s.x<e.width&&s.y<e.height&&(s.x<i||s.x>e.width-i)&&(s.y<i||s.y>e.height-i)}}class d{constructor(t,e){this.leftPage=null,this.rightPage=null,this.flippingPage=null,this.bottomPage=null,this.direction=null,this.orientation=null,this.shadow=null,this.animation=null,this.pageRect=null,this.boundsRect=null,this.timer=0,this.safari=!1,this.setting=e,this.app=t;let i=RegExp("Version\\/[\\d\\.]+.*Safari/");this.safari=null!==i.exec(window.navigator.userAgent)}render(t){if(null!==this.animation){let e=Math.round((t-this.animation.startedAt)/this.animation.durationFrame);e<this.animation.frames.length?this.animation.frames[e]():(this.animation.onAnimateEnd(),this.animation=null)}this.timer=t,this.drawFrame()}start(){this.update();let t=e=>{this.render(e),requestAnimationFrame(t)};requestAnimationFrame(t)}startAnimation(t,e,i){this.finishAnimation(),this.animation={frames:t,duration:e,durationFrame:e/t.length,onAnimateEnd:i,startedAt:this.timer}}finishAnimation(){null!==this.animation&&(this.animation.frames[this.animation.frames.length-1](),null!==this.animation.onAnimateEnd&&this.animation.onAnimateEnd()),this.animation=null}update(){this.boundsRect=null;let t=this.calculateBoundsRect();this.orientation!==t&&(this.orientation=t,this.app.updateOrientation(t))}calculateBoundsRect(){let t="landscape",e=this.getBlockWidth(),i=e/2,s=this.getBlockHeight()/2,n=this.setting.width/this.setting.height,r=this.setting.width,o=this.setting.height,a=i-r;return"stretch"===this.setting.size?(e<2*this.setting.minWidth&&this.app.getSettings().usePortrait&&(t="portrait"),(r="portrait"===t?this.getBlockWidth():this.getBlockWidth()/2)>this.setting.maxWidth&&(r=this.setting.maxWidth),(o=r/n)>this.getBlockHeight()&&(r=(o=this.getBlockHeight())*n),a="portrait"===t?i-r/2-r:i-r):e<2*r&&this.app.getSettings().usePortrait&&(t="portrait",a=i-r/2-r),this.boundsRect={left:a,top:s-o/2,width:2*r,height:o,pageWidth:r},t}setShadowData(t,e,i,s){if(!this.app.getSettings().drawShadow)return;let n=100*this.getSettings().maxShadowOpacity;this.shadow={pos:t,angle:e,width:3*this.getRect().pageWidth/4*i/100,opacity:(100-i)*n/100/100,direction:s,progress:2*i}}clearShadow(){this.shadow=null}getBlockWidth(){return this.app.getUI().getDistElement().offsetWidth}getBlockHeight(){return this.app.getUI().getDistElement().offsetHeight}getDirection(){return this.direction}getRect(){return null===this.boundsRect&&this.calculateBoundsRect(),this.boundsRect}getSettings(){return this.app.getSettings()}getOrientation(){return this.orientation}setPageRect(t){this.pageRect=t}setDirection(t){this.direction=t}setRightPage(t){null!==t&&t.setOrientation(1),this.rightPage=t}setLeftPage(t){null!==t&&t.setOrientation(0),this.leftPage=t}setBottomPage(t){null!==t&&t.setOrientation(+(1!==this.direction)),this.bottomPage=t}setFlippingPage(t){null!==t&&t.setOrientation(+(0!==this.direction||"portrait"===this.orientation)),this.flippingPage=t}convertToBook(t){let e=this.getRect();return{x:t.x-e.left,y:t.y-e.top}}isSafari(){return this.safari}convertToPage(t,e){e||(e=this.direction);let i=this.getRect();return{x:0===e?t.x-i.left-i.width/2:i.width/2-t.x+i.left,y:t.y-i.top}}convertToGlobal(t,e){if(e||(e=this.direction),null==t)return null;let i=this.getRect();return{x:0===e?t.x+i.left+i.width/2:i.width/2-t.x+i.left,y:t.y+i.top}}convertRectToGlobal(t,e){return e||(e=this.direction),{topLeft:this.convertToGlobal(t.topLeft,e),topRight:this.convertToGlobal(t.topRight,e),bottomLeft:this.convertToGlobal(t.bottomLeft,e),bottomRight:this.convertToGlobal(t.bottomRight,e)}}}class g extends d{constructor(t,e,i){super(t,e),this.canvas=i,this.ctx=i.getContext("2d")}getContext(){return this.ctx}reload(){}drawFrame(){this.clear(),"portrait"!==this.orientation&&null!=this.leftPage&&this.leftPage.simpleDraw(0),null!=this.rightPage&&this.rightPage.simpleDraw(1),null!=this.bottomPage&&this.bottomPage.draw(),this.drawBookShadow(),null!=this.flippingPage&&this.flippingPage.draw(),null!=this.shadow&&(this.drawOuterShadow(),this.drawInnerShadow());let t=this.getRect();"portrait"===this.orientation&&(this.ctx.beginPath(),this.ctx.rect(t.left+t.pageWidth,t.top,t.width,t.height),this.ctx.clip())}drawBookShadow(){let t=this.getRect();this.ctx.save(),this.ctx.beginPath();let e=t.width/20;this.ctx.rect(t.left,t.top,t.width,t.height);let i={x:t.left+t.width/2-e/2,y:0};this.ctx.translate(i.x,i.y);let s=this.ctx.createLinearGradient(0,0,e,0);s.addColorStop(0,"rgba(0, 0, 0, 0)"),s.addColorStop(.4,"rgba(0, 0, 0, 0.2)"),s.addColorStop(.49,"rgba(0, 0, 0, 0.1)"),s.addColorStop(.5,"rgba(0, 0, 0, 0.5)"),s.addColorStop(.51,"rgba(0, 0, 0, 0.4)"),s.addColorStop(1,"rgba(0, 0, 0, 0)"),this.ctx.clip(),this.ctx.fillStyle=s,this.ctx.fillRect(0,0,e,2*t.height),this.ctx.restore()}drawOuterShadow(){let t=this.getRect();this.ctx.save(),this.ctx.beginPath(),this.ctx.rect(t.left,t.top,t.width,t.height);let e=this.convertToGlobal({x:this.shadow.pos.x,y:this.shadow.pos.y});this.ctx.translate(e.x,e.y),this.ctx.rotate(Math.PI+this.shadow.angle+Math.PI/2);let i=this.ctx.createLinearGradient(0,0,this.shadow.width,0);0===this.shadow.direction?(this.ctx.translate(0,-100),i.addColorStop(0,"rgba(0, 0, 0, "+this.shadow.opacity+")"),i.addColorStop(1,"rgba(0, 0, 0, 0)")):(this.ctx.translate(-this.shadow.width,-100),i.addColorStop(0,"rgba(0, 0, 0, 0)"),i.addColorStop(1,"rgba(0, 0, 0, "+this.shadow.opacity+")")),this.ctx.clip(),this.ctx.fillStyle=i,this.ctx.fillRect(0,0,this.shadow.width,2*t.height),this.ctx.restore()}drawInnerShadow(){let t=this.getRect();this.ctx.save(),this.ctx.beginPath();let e=this.convertToGlobal({x:this.shadow.pos.x,y:this.shadow.pos.y}),i=this.convertRectToGlobal(this.pageRect);this.ctx.moveTo(i.topLeft.x,i.topLeft.y),this.ctx.lineTo(i.topRight.x,i.topRight.y),this.ctx.lineTo(i.bottomRight.x,i.bottomRight.y),this.ctx.lineTo(i.bottomLeft.x,i.bottomLeft.y),this.ctx.translate(e.x,e.y),this.ctx.rotate(Math.PI+this.shadow.angle+Math.PI/2);let s=3*this.shadow.width/4,n=this.ctx.createLinearGradient(0,0,s,0);0===this.shadow.direction?(this.ctx.translate(-s,-100),n.addColorStop(1,"rgba(0, 0, 0, "+this.shadow.opacity+")"),n.addColorStop(.9,"rgba(0, 0, 0, 0.05)"),n.addColorStop(.7,"rgba(0, 0, 0, "+this.shadow.opacity+")"),n.addColorStop(0,"rgba(0, 0, 0, 0)")):(this.ctx.translate(0,-100),n.addColorStop(0,"rgba(0, 0, 0, "+this.shadow.opacity+")"),n.addColorStop(.1,"rgba(0, 0, 0, 0.05)"),n.addColorStop(.3,"rgba(0, 0, 0, "+this.shadow.opacity+")"),n.addColorStop(1,"rgba(0, 0, 0, 0)")),this.ctx.clip(),this.ctx.fillStyle=n,this.ctx.fillRect(0,0,s,2*t.height),this.ctx.restore()}clear(){this.ctx.fillStyle="white",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height)}}class p{constructor(t,e,i){this.touchPoint=null,this.swipeTimeout=250,this.onResize=()=>{this.update()},this.onMouseDown=t=>{if(this.checkTarget(t.target)){let e=this.getMousePos(t.clientX,t.clientY);this.app.startUserTouch(e),t.preventDefault()}},this.onTouchStart=t=>{if(this.checkTarget(t.target)&&t.changedTouches.length>0){let e=t.changedTouches[0],i=this.getMousePos(e.clientX,e.clientY);this.touchPoint={point:i,time:Date.now()},setTimeout(()=>{null!==this.touchPoint&&this.app.startUserTouch(i)},this.swipeTimeout),this.app.getSettings().mobileScrollSupport||t.preventDefault()}},this.onMouseUp=t=>{let e=this.getMousePos(t.clientX,t.clientY);this.app.userStop(e)},this.onMouseMove=t=>{let e=this.getMousePos(t.clientX,t.clientY);this.app.userMove(e,!1)},this.onTouchMove=t=>{if(t.changedTouches.length>0){let e=t.changedTouches[0],i=this.getMousePos(e.clientX,e.clientY);this.app.getSettings().mobileScrollSupport?(null!==this.touchPoint&&(Math.abs(this.touchPoint.point.x-i.x)>10||"read"!==this.app.getState())&&t.cancelable&&this.app.userMove(i,!0),"read"!==this.app.getState()&&t.preventDefault()):this.app.userMove(i,!0)}},this.onTouchEnd=t=>{if(t.changedTouches.length>0){let e=t.changedTouches[0],i=this.getMousePos(e.clientX,e.clientY),s=!1;if(null!==this.touchPoint){let t=i.x-this.touchPoint.point.x,e=Math.abs(i.y-this.touchPoint.point.y);Math.abs(t)>this.swipeDistance&&e<2*this.swipeDistance&&Date.now()-this.touchPoint.time<this.swipeTimeout&&(t>0?this.app.flipPrev(this.touchPoint.point.y<this.app.getRender().getRect().height/2?"top":"bottom"):this.app.flipNext(this.touchPoint.point.y<this.app.getRender().getRect().height/2?"top":"bottom"),s=!0),this.touchPoint=null}this.app.userStop(i,s)}},this.parentElement=t,t.classList.add("stf__parent"),t.insertAdjacentHTML("afterbegin",'<div class="stf__wrapper"></div>'),this.wrapper=t.querySelector(".stf__wrapper"),this.app=e;let s=this.app.getSettings().usePortrait?1:2;t.style.minWidth=i.minWidth*s+"px",t.style.minHeight=i.minHeight+"px","fixed"===i.size&&(t.style.minWidth=i.width*s+"px",t.style.minHeight=i.height+"px"),i.autoSize&&(t.style.width="100%",t.style.maxWidth=2*i.maxWidth+"px"),t.style.display="block",window.addEventListener("resize",this.onResize,!1),this.swipeDistance=i.swipeDistance}destroy(){this.app.getSettings().useMouseEvents&&this.removeHandlers(),this.distElement.remove(),this.wrapper.remove()}getDistElement(){return this.distElement}getWrapper(){return this.wrapper}setOrientationStyle(t){this.wrapper.classList.remove("--portrait","--landscape"),"portrait"===t?(this.app.getSettings().autoSize&&(this.wrapper.style.paddingBottom=this.app.getSettings().height/this.app.getSettings().width*100+"%"),this.wrapper.classList.add("--portrait")):(this.app.getSettings().autoSize&&(this.wrapper.style.paddingBottom=this.app.getSettings().height/(2*this.app.getSettings().width)*100+"%"),this.wrapper.classList.add("--landscape")),this.update()}removeHandlers(){window.removeEventListener("resize",this.onResize),this.distElement.removeEventListener("mousedown",this.onMouseDown),this.distElement.removeEventListener("touchstart",this.onTouchStart),window.removeEventListener("mousemove",this.onMouseMove),window.removeEventListener("touchmove",this.onTouchMove),window.removeEventListener("mouseup",this.onMouseUp),window.removeEventListener("touchend",this.onTouchEnd)}setHandlers(){window.addEventListener("resize",this.onResize,!1),this.app.getSettings().useMouseEvents&&(this.distElement.addEventListener("mousedown",this.onMouseDown),this.distElement.addEventListener("touchstart",this.onTouchStart),window.addEventListener("mousemove",this.onMouseMove),window.addEventListener("touchmove",this.onTouchMove,{passive:!this.app.getSettings().mobileScrollSupport}),window.addEventListener("mouseup",this.onMouseUp),window.addEventListener("touchend",this.onTouchEnd))}getMousePos(t,e){let i=this.distElement.getBoundingClientRect();return{x:t-i.left,y:e-i.top}}checkTarget(t){return!this.app.getSettings().clickEventForward||!["a","button"].includes(t.tagName.toLowerCase())}}class c extends p{constructor(t,e,i,s){for(let n of(super(t,e,i),this.wrapper.insertAdjacentHTML("afterbegin",'<div class="stf__block"></div>'),this.distElement=t.querySelector(".stf__block"),this.items=s,s))this.distElement.appendChild(n);this.setHandlers()}clear(){for(let t of this.items)this.parentElement.appendChild(t)}updateItems(t){for(let e of(this.removeHandlers(),this.distElement.innerHTML="",t))this.distElement.appendChild(e);this.items=t,this.setHandlers()}update(){this.app.getRender().update()}}class u extends p{constructor(t,e,i){super(t,e,i),this.wrapper.innerHTML='<canvas class="stf__canvas"></canvas>',this.canvas=t.querySelectorAll("canvas")[0],this.distElement=this.canvas,this.resizeCanvas(),this.setHandlers()}resizeCanvas(){let t=getComputedStyle(this.canvas),e=parseInt(t.getPropertyValue("width"),10),i=parseInt(t.getPropertyValue("height"),10);this.canvas.width=e,this.canvas.height=i}getCanvas(){return this.canvas}update(){this.resizeCanvas(),this.app.getRender().update()}}class f extends d{constructor(t,e,i){super(t,e),this.outerShadow=null,this.innerShadow=null,this.hardShadow=null,this.hardInnerShadow=null,this.element=i,this.createShadows()}createShadows(){this.element.insertAdjacentHTML("beforeend",'<div class="stf__outerShadow"></div>\n             <div class="stf__innerShadow"></div>\n             <div class="stf__hardShadow"></div>\n             <div class="stf__hardInnerShadow"></div>'),this.outerShadow=this.element.querySelector(".stf__outerShadow"),this.innerShadow=this.element.querySelector(".stf__innerShadow"),this.hardShadow=this.element.querySelector(".stf__hardShadow"),this.hardInnerShadow=this.element.querySelector(".stf__hardInnerShadow")}clearShadow(){super.clearShadow(),this.outerShadow.style.cssText="display: none",this.innerShadow.style.cssText="display: none",this.hardShadow.style.cssText="display: none",this.hardInnerShadow.style.cssText="display: none"}reload(){this.element.querySelector(".stf__outerShadow")||this.createShadows()}drawHardInnerShadow(){let t=this.getRect(),e=this.shadow.progress>100?200-this.shadow.progress:this.shadow.progress,i=(100-e)*(2.5*t.pageWidth)/100+20;i>t.pageWidth&&(i=t.pageWidth);let s=`
            display: block;
            z-index: ${(this.getSettings().startZIndex+5).toString(10)};
            width: ${i}px;
            height: ${t.height}px;
            background: linear-gradient(to right,
                rgba(0, 0, 0, ${this.shadow.opacity*e/100}) 5%,
                rgba(0, 0, 0, 0) 100%);
            left: ${t.left+t.width/2}px;
            transform-origin: 0 0;
        `;s+=0===this.getDirection()&&this.shadow.progress>100||1===this.getDirection()&&this.shadow.progress<=100?"transform: translate3d(0, 0, 0);":"transform: translate3d(0, 0, 0) rotateY(180deg);",this.hardInnerShadow.style.cssText=s}drawHardOuterShadow(){let t=this.getRect(),e=(100-(this.shadow.progress>100?200-this.shadow.progress:this.shadow.progress))*(2.5*t.pageWidth)/100+20;e>t.pageWidth&&(e=t.pageWidth);let i=`
            display: block;
            z-index: ${(this.getSettings().startZIndex+4).toString(10)};
            width: ${e}px;
            height: ${t.height}px;
            background: linear-gradient(to left, rgba(0, 0, 0, ${this.shadow.opacity}) 5%, rgba(0, 0, 0, 0) 100%);
            left: ${t.left+t.width/2}px;
            transform-origin: 0 0;
        `;i+=0===this.getDirection()&&this.shadow.progress>100||1===this.getDirection()&&this.shadow.progress<=100?"transform: translate3d(0, 0, 0) rotateY(180deg);":"transform: translate3d(0, 0, 0);",this.hardShadow.style.cssText=i}drawInnerShadow(){let t=this.getRect(),e=3*this.shadow.width/4,i=0===this.getDirection()?e:0,s=0===this.getDirection()?"to left":"to right",n=this.convertToGlobal(this.shadow.pos),o=this.shadow.angle+3*Math.PI/2,a=[this.pageRect.topLeft,this.pageRect.topRight,this.pageRect.bottomRight,this.pageRect.bottomLeft],h="polygon( ";for(let t of a){let e=1===this.getDirection()?{x:-t.x+this.shadow.pos.x,y:t.y-this.shadow.pos.y}:{x:t.x-this.shadow.pos.x,y:t.y-this.shadow.pos.y};h+=(e=r.GetRotatedPoint(e,{x:i,y:100},o)).x+"px "+e.y+"px, "}h=h.slice(0,-2)+")";let l=`
            display: block;
            z-index: ${(this.getSettings().startZIndex+10).toString(10)};
            width: ${e}px;
            height: ${2*t.height}px;
            background: linear-gradient(${s},
                rgba(0, 0, 0, ${this.shadow.opacity}) 5%,
                rgba(0, 0, 0, 0.05) 15%,
                rgba(0, 0, 0, ${this.shadow.opacity}) 35%,
                rgba(0, 0, 0, 0) 100%);
            transform-origin: ${i}px 100px;
            transform: translate3d(${n.x-i}px, ${n.y-100}px, 0) rotate(${o}rad);
            clip-path: ${h};
            -webkit-clip-path: ${h};
        `;this.innerShadow.style.cssText=l}drawOuterShadow(){let t=this.getRect(),e=this.convertToGlobal({x:this.shadow.pos.x,y:this.shadow.pos.y}),i=this.shadow.angle+3*Math.PI/2,s=1===this.getDirection()?this.shadow.width:0,n=0===this.getDirection()?"to right":"to left",o=[{x:0,y:0},{x:t.pageWidth,y:0},{x:t.pageWidth,y:t.height},{x:0,y:t.height}],a="polygon( ";for(let t of o)if(null!==t){let e=1===this.getDirection()?{x:-t.x+this.shadow.pos.x,y:t.y-this.shadow.pos.y}:{x:t.x-this.shadow.pos.x,y:t.y-this.shadow.pos.y};a+=(e=r.GetRotatedPoint(e,{x:s,y:100},i)).x+"px "+e.y+"px, "}a=a.slice(0,-2)+")";let h=`
            display: block;
            z-index: ${(this.getSettings().startZIndex+10).toString(10)};
            width: ${this.shadow.width}px;
            height: ${2*t.height}px;
            background: linear-gradient(${n}, rgba(0, 0, 0, ${this.shadow.opacity}), rgba(0, 0, 0, 0));
            transform-origin: ${s}px 100px;
            transform: translate3d(${e.x-s}px, ${e.y-100}px, 0) rotate(${i}rad);
            clip-path: ${a};
            -webkit-clip-path: ${a};
        `;this.outerShadow.style.cssText=h}drawLeftPage(){"portrait"!==this.orientation&&null!==this.leftPage&&(1===this.direction&&null!==this.flippingPage&&"hard"===this.flippingPage.getDrawingDensity()?(this.leftPage.getElement().style.zIndex=(this.getSettings().startZIndex+5).toString(10),this.leftPage.setHardDrawingAngle(180+this.flippingPage.getHardAngle()),this.leftPage.draw(this.flippingPage.getDrawingDensity())):this.leftPage.simpleDraw(0))}drawRightPage(){null!==this.rightPage&&(0===this.direction&&null!==this.flippingPage&&"hard"===this.flippingPage.getDrawingDensity()?(this.rightPage.getElement().style.zIndex=(this.getSettings().startZIndex+5).toString(10),this.rightPage.setHardDrawingAngle(180+this.flippingPage.getHardAngle()),this.rightPage.draw(this.flippingPage.getDrawingDensity())):this.rightPage.simpleDraw(1))}drawBottomPage(){if(null===this.bottomPage)return;let t=null!=this.flippingPage?this.flippingPage.getDrawingDensity():null;"portrait"===this.orientation&&1===this.direction||(this.bottomPage.getElement().style.zIndex=(this.getSettings().startZIndex+3).toString(10),this.bottomPage.draw(t))}drawFrame(){this.clear(),this.drawLeftPage(),this.drawRightPage(),this.drawBottomPage(),null!=this.flippingPage&&(this.flippingPage.getElement().style.zIndex=(this.getSettings().startZIndex+5).toString(10),this.flippingPage.draw()),null!=this.shadow&&null!==this.flippingPage&&("soft"===this.flippingPage.getDrawingDensity()?(this.drawOuterShadow(),this.drawInnerShadow()):(this.drawHardOuterShadow(),this.drawHardInnerShadow()))}clear(){for(let t of this.app.getPageCollection().getPages())t!==this.leftPage&&t!==this.rightPage&&t!==this.flippingPage&&t!==this.bottomPage&&(t.getElement().style.cssText="display: none"),t.getTemporaryCopy()!==this.flippingPage&&t.hideTemporaryCopy()}update(){super.update(),null!==this.rightPage&&this.rightPage.setOrientation(1),null!==this.leftPage&&this.leftPage.setOrientation(0)}}class m{constructor(){this._default={startPage:0,size:"fixed",width:0,height:0,minWidth:0,maxWidth:0,minHeight:0,maxHeight:0,drawShadow:!0,flippingTime:1e3,usePortrait:!0,startZIndex:0,autoSize:!0,maxShadowOpacity:1,showCover:!1,mobileScrollSupport:!0,swipeDistance:30,clickEventForward:!0,useMouseEvents:!0,showPageCorners:!0,disableFlipByClick:!1}}getSettings(t){let e=this._default;if(Object.assign(e,t),"stretch"!==e.size&&"fixed"!==e.size)throw Error('Invalid size type. Available only "fixed" and "stretch" value');if(e.width<=0||e.height<=0)throw Error("Invalid width or height");if(e.flippingTime<=0)throw Error("Invalid flipping time");return"stretch"===e.size?(e.minWidth<=0&&(e.minWidth=100),e.maxWidth<e.minWidth&&(e.maxWidth=2e3),e.minHeight<=0&&(e.minHeight=100),e.maxHeight<e.minHeight&&(e.maxHeight=2e3)):(e.minWidth=e.width,e.maxWidth=e.width,e.minHeight=e.height,e.maxHeight=e.height),e}}(function(t,e){void 0===e&&(e={});var i=e.insertAt;if(t&&"undefined"!=typeof document){var s=document.head||document.getElementsByTagName("head")[0],n=document.createElement("style");n.type="text/css","top"===i&&s.firstChild?s.insertBefore(n,s.firstChild):s.appendChild(n),n.styleSheet?n.styleSheet.cssText=t:n.appendChild(document.createTextNode(t))}})(".stf__parent {\n  position: relative;\n  display: block;\n  box-sizing: border-box;\n  transform: translateZ(0);\n\n  -ms-touch-action: pan-y;\n  touch-action: pan-y;\n}\n\n.sft__wrapper {\n  position: relative;\n  width: 100%;\n  box-sizing: border-box;\n}\n\n.stf__parent canvas {\n  position: absolute;\n  width: 100%;\n  height: 100%;\n  left: 0;\n  top: 0;\n}\n\n.stf__block {\n  position: absolute;\n  width: 100%;\n  height: 100%;\n  box-sizing: border-box;\n  perspective: 2000px;\n}\n\n.stf__item {\n  display: none;\n  position: absolute;\n  transform-style: preserve-3d;\n}\n\n.stf__outerShadow {\n  position: absolute;\n  left: 0;\n  top: 0;\n}\n\n.stf__innerShadow {\n  position: absolute;\n  left: 0;\n  top: 0;\n}\n\n.stf__hardShadow {\n  position: absolute;\n  left: 0;\n  top: 0;\n}\n\n.stf__hardInnerShadow {\n  position: absolute;\n  left: 0;\n  top: 0;\n}"),t.PageFlip=class extends class{constructor(){this.events=new Map}on(t,e){return this.events.has(t)?this.events.get(t).push(e):this.events.set(t,[e]),this}off(t){this.events.delete(t)}trigger(t,e,i=null){if(this.events.has(t))for(let s of this.events.get(t))s({data:i,object:e})}}{constructor(t,e){super(),this.isUserTouch=!1,this.isUserMove=!1,this.setting=null,this.pages=null,this.setting=(new m).getSettings(e),this.block=t}destroy(){this.ui.destroy(),this.block.remove()}update(){this.render.update(),this.pages.show()}loadFromImages(t){this.ui=new u(this.block,this,this.setting);let e=this.ui.getCanvas();this.render=new g(this,this.setting,e),this.flipController=new l(this.render,this),this.pages=new n(this,this.render,t),this.pages.load(),this.render.start(),this.pages.show(this.setting.startPage),setTimeout(()=>{this.ui.update(),this.trigger("init",this,{page:this.setting.startPage,mode:this.render.getOrientation()})},1)}loadFromHTML(t){this.ui=new c(this.block,this,this.setting,t),this.render=new f(this,this.setting,this.ui.getDistElement()),this.flipController=new l(this.render,this),this.pages=new a(this,this.render,this.ui.getDistElement(),t),this.pages.load(),this.render.start(),this.pages.show(this.setting.startPage),setTimeout(()=>{this.ui.update(),this.trigger("init",this,{page:this.setting.startPage,mode:this.render.getOrientation()})},1)}updateFromImages(t){let e=this.pages.getCurrentPageIndex();this.pages.destroy(),this.pages=new n(this,this.render,t),this.pages.load(),this.pages.show(e),this.trigger("update",this,{page:e,mode:this.render.getOrientation()})}updateFromHtml(t){let e=this.pages.getCurrentPageIndex();this.pages.destroy(),this.pages=new a(this,this.render,this.ui.getDistElement(),t),this.pages.load(),this.ui.updateItems(t),this.render.reload(),this.pages.show(e),this.trigger("update",this,{page:e,mode:this.render.getOrientation()})}clear(){this.pages.destroy(),this.ui.clear()}turnToPrevPage(){this.pages.showPrev()}turnToNextPage(){this.pages.showNext()}turnToPage(t){this.pages.show(t)}flipNext(t="top"){this.flipController.flipNext(t)}flipPrev(t="top"){this.flipController.flipPrev(t)}flip(t,e="top"){this.flipController.flipToPage(t,e)}updateState(t){this.trigger("changeState",this,t)}updatePageIndex(t){this.trigger("flip",this,t)}updateOrientation(t){this.ui.setOrientationStyle(t),this.update(),this.trigger("changeOrientation",this,t)}getPageCount(){return this.pages.getPageCount()}getCurrentPageIndex(){return this.pages.getCurrentPageIndex()}getPage(t){return this.pages.getPage(t)}getRender(){return this.render}getFlipController(){return this.flipController}getOrientation(){return this.render.getOrientation()}getBoundsRect(){return this.render.getRect()}getSettings(){return this.setting}getUI(){return this.ui}getState(){return this.flipController.getState()}getPageCollection(){return this.pages}startUserTouch(t){this.mousePosition=t,this.isUserTouch=!0,this.isUserMove=!1}userMove(t,e){this.isUserTouch||e||!this.setting.showPageCorners?this.isUserTouch&&r.GetDistanceBetweenTwoPoint(this.mousePosition,t)>5&&(this.isUserMove=!0,this.flipController.fold(t)):this.flipController.showCorner(t)}userStop(t,e=!1){this.isUserTouch&&(this.isUserTouch=!1,e||(this.isUserMove?this.flipController.stopMove():this.flipController.flip(t)))}},Object.defineProperty(t,"__esModule",{value:!0})}(e)},6896:(t,e,i)=>{"use strict";i.d(e,{s:()=>d});var s=i(4331),n=i(8802),r=i(5982);function o(t,e){[...e].reverse().forEach(i=>{let s=t.getVariant(i);s&&(0,n.U)(t,s),t.variantChildren&&t.variantChildren.forEach(t=>{o(t,e)})})}function a(){let t=!1,e=new Set,i={subscribe:t=>(e.add(t),()=>void e.delete(t)),start(i,n){(0,s.V1)(t,"controls.start() should only be called after a component has mounted. Consider calling within a useEffect hook.");let o=[];return e.forEach(t=>{o.push((0,r._)(t,i,{transitionOverride:n}))}),Promise.all(o)},set:i=>((0,s.V1)(t,"controls.set() should only be called after a component has mounted. Consider calling within a useEffect hook."),e.forEach(t=>{Array.isArray(i)?o(t,i):"string"==typeof i?o(t,[i]):(0,n.U)(t,i)})),stop(){e.forEach(t=>{!function(t){t.values.forEach(t=>t.stop())}(t)})},mount:()=>(t=!0,()=>{t=!1,i.stop()})};return i}var h=i(2885),l=i(7494);let d=function(){let t=(0,h.M)(a);return(0,l.E)(t.mount,[]),t}},9988:(t,e,i)=>{"use strict";i.d(e,{T5:()=>L,c4:()=>u,pH:()=>z});var s=i(2115),n=i(7650),r=i(1616);function o(){return(o=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var s in i)({}).hasOwnProperty.call(i,s)&&(t[s]=i[s])}return t}).apply(null,arguments)}function a(t,e){if(null==t)return{};var i={};for(var s in t)if(({}).hasOwnProperty.call(t,s)){if(-1!==e.indexOf(s))continue;i[s]=t[s]}return i}function h(t){var e=function(t,e){if("object"!=typeof t||!t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var s=i.call(t,e||"default");if("object"!=typeof s)return s;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:e+""}let l={NOT_LOADED:"NOT_LOADED",LOADING:"LOADING",LOADED:"LOADED",FAILED:"FAILED",AUTH_FAILURE:"AUTH_FAILURE"};class d{static async load(t,e){var i;let s=t.libraries?t.libraries.split(","):[],n=this.serializeParams(t);this.listeners.push(e),null!=(i=window.google)&&null!=(i=i.maps)&&i.importLibrary?(this.serializedApiParams||(this.loadingStatus=l.LOADED),this.notifyLoadingStatusListeners()):(this.serializedApiParams=n,this.initImportLibrary(t)),this.serializedApiParams&&this.serializedApiParams!==n&&console.warn("[google-maps-api-loader] The maps API has already been loaded with different parameters and will not be loaded again. Refresh the page for new values to have effect.");let r=["maps",...s];await Promise.all(r.map(t=>google.maps.importLibrary(t)))}static serializeParams(t){return[t.v,t.key,t.language,t.region,t.authReferrerPolicy,t.solutionChannel].join("/")}static initImportLibrary(t){if(window.google||(window.google={}),window.google.maps||(window.google.maps={}),window.google.maps.importLibrary){console.error("[google-maps-api-loader-internal]: initImportLibrary must only be called once");return}let e=null,i=()=>e||(e=new Promise((e,i)=>{var s;let n=document.createElement("script"),r=new URLSearchParams;for(let[e,i]of Object.entries(t)){let t=e.replace(/[A-Z]/g,t=>"_"+t[0].toLowerCase());r.set(t,String(i))}r.set("loading","async"),r.set("callback","__googleMapsCallback__"),n.async=!0,n.src="https://maps.googleapis.com/maps/api/js?"+r.toString(),n.nonce=(null==(s=document.querySelector("script[nonce]"))?void 0:s.nonce)||"",n.onerror=()=>{this.loadingStatus=l.FAILED,this.notifyLoadingStatusListeners(),i(Error("The Google Maps JavaScript API could not load."))},window.__googleMapsCallback__=()=>{this.loadingStatus=l.LOADED,this.notifyLoadingStatusListeners(),e()},window.gm_authFailure=()=>{this.loadingStatus=l.AUTH_FAILURE,this.notifyLoadingStatusListeners()},this.loadingStatus=l.LOADING,this.notifyLoadingStatusListeners(),document.head.append(n)}));google.maps.importLibrary=t=>i().then(()=>google.maps.importLibrary(t))}static notifyLoadingStatusListeners(){for(let t of this.listeners)t(this.loadingStatus)}}d.loadingStatus=l.NOT_LOADED,d.serializedApiParams=void 0,d.listeners=[];let g=["onLoad","onError","apiKey","version","libraries"],p=["children"],c=s.createContext(null),u=t=>{let{children:e}=t,i=a(t,p),{mapInstances:n,addMapInstance:r,removeMapInstance:l,clearMapInstances:u}=function(){let[t,e]=(0,s.useState)({});return{mapInstances:t,addMapInstance:(t,i="default")=>{e(e=>o({},e,{[i]:t}))},removeMapInstance:(t="default")=>{e(e=>a(e,[t].map(h)))},clearMapInstances:()=>{e({})}}}(),{status:f,loadedLibraries:m,importLibrary:w}=function(t){let{onLoad:e,onError:i,apiKey:n,version:r,libraries:h=[]}=t,l=a(t,g),[p,c]=(0,s.useState)(d.loadingStatus),[u,f]=(0,s.useReducer)((t,e)=>t[e.name]?t:o({},t,{[e.name]:e.value}),{}),m=(0,s.useMemo)(()=>null==h?void 0:h.join(","),[h]),w=(0,s.useMemo)(()=>JSON.stringify(o({apiKey:n,version:r},l)),[n,r,l]),y=(0,s.useCallback)(async t=>{var e;if(u[t])return u[t];if(!(null!=(e=google)&&null!=(e=e.maps)&&e.importLibrary))throw Error("[api-provider-internal] importLibrary was called before google.maps.importLibrary was defined.");let i=await window.google.maps.importLibrary(t);return f({name:t,value:i}),i},[u]);return(0,s.useEffect)(()=>{(async()=>{try{let t=o({key:n},l);for(let e of(r&&(t.v=r),(null==m?void 0:m.length)>0&&(t.libraries=m),(void 0===t.channel||t.channel<0||t.channel>999)&&delete t.channel,void 0===t.solutionChannel?t.solutionChannel="GMP_visgl_rgmlibrary_v1_default":""===t.solutionChannel&&delete t.solutionChannel,await d.load(t,t=>c(t)),["core","maps",...h]))await y(e);e&&e()}catch(t){i?i(t):console.error("<ApiProvider> failed to load the Google Maps JavaScript API",t)}})()},[n,m,w]),{status:p,loadedLibraries:u,importLibrary:y}}(i),y=(0,s.useMemo)(()=>({mapInstances:n,addMapInstance:r,removeMapInstance:l,clearMapInstances:u,status:f,loadedLibraries:m,importLibrary:w}),[n,r,l,u,f,m,w]);return s.createElement(c.Provider,{value:y},e)},f={onBoundsChanged:"bounds_changed",onCenterChanged:"center_changed",onClick:"click",onContextmenu:"contextmenu",onDblclick:"dblclick",onDrag:"drag",onDragend:"dragend",onDragstart:"dragstart",onHeadingChanged:"heading_changed",onIdle:"idle",onIsFractionalZoomEnabledChanged:"isfractionalzoomenabled_changed",onMapCapabilitiesChanged:"mapcapabilities_changed",onMapTypeIdChanged:"maptypeid_changed",onMousemove:"mousemove",onMouseout:"mouseout",onMouseover:"mouseover",onProjectionChanged:"projection_changed",onRenderingTypeChanged:"renderingtype_changed",onTilesLoaded:"tilesloaded",onTiltChanged:"tilt_changed",onZoomChanged:"zoom_changed",onCameraChanged:"bounds_changed"},m=["bounds_changed","center_changed","heading_changed","tilt_changed","zoom_changed"],w=["click","contextmenu","dblclick","mousemove","mouseout","mouseover"],y=Object.keys(f),x=new Set(["backgroundColor","clickableIcons","controlSize","disableDefaultUI","disableDoubleClickZoom","draggable","draggableCursor","draggingCursor","fullscreenControl","fullscreenControlOptions","gestureHandling","headingInteractionEnabled","isFractionalZoomEnabled","keyboardShortcuts","mapTypeControl","mapTypeControlOptions","mapTypeId","maxZoom","minZoom","noClear","panControl","panControlOptions","restriction","rotateControl","rotateControlOptions","scaleControl","scaleControlOptions","scrollwheel","streetView","streetViewControl","streetViewControlOptions","styles","tiltInteractionEnabled","zoomControl","zoomControlOptions"]);function P(){var t;return(null==(t=(0,s.useContext)(c))?void 0:t.status)||l.NOT_LOADED}function v(t){return t&&"object"==typeof t&&"lat"in t&&"lng"in t&&Number.isFinite(t.lat)&&Number.isFinite(t.lng)?t:t.toJSON()}let b=()=>s.createElement("div",{style:{position:"absolute",top:0,left:0,bottom:0,right:0,zIndex:999,display:"flex",flexFlow:"column nowrap",textAlign:"center",justifyContent:"center",fontSize:".8rem",color:"rgba(0,0,0,0.6)",background:"#dddddd",padding:"1rem 1.5rem"}},s.createElement("h2",null,"Error: AuthFailure"),s.createElement("p",null,"A problem with your API key prevents the map from rendering correctly. Please make sure the value of the ",s.createElement("code",null,"APIProvider.apiKey")," prop is correct. Check the error-message in the console for further details."));function S(){return P()===l.LOADED}let C=["id","defaultBounds","defaultCenter","defaultZoom","defaultHeading","defaultTilt","reuseMaps","renderingType","colorScheme"],E=["padding"];class I{static has(t){return this.entries[t]&&this.entries[t].length>0}static pop(t){return this.entries[t]&&this.entries[t].pop()||null}static push(t,e){this.entries[t]||(this.entries[t]=[]),this.entries[t].push(e)}}I.entries={};let T=s.createContext(null),L=t=>{let{children:e,id:i,className:n,style:h}=t,d=(0,s.useContext)(c),g=P();if(!d)throw Error("<Map> can only be used inside an <ApiProvider> component.");let[p,u,L]=function(t,e){let i=S(),[n,r]=(0,s.useState)(null),[h,l]=function(){let[t,e]=(0,s.useState)(null);return[t,(0,s.useCallback)(t=>e(t),[e])]}(),d=function(t){let e=function(){let[,t]=(0,s.useReducer)(t=>t+1,0);return t}(),i=(0,s.useRef)({center:{lat:0,lng:0},heading:0,tilt:0,zoom:0});return(0,s.useEffect)(()=>{if(!t)return;let s=google.maps.event.addListener(t,"bounds_changed",()=>{(function(t,e){let i=t.getCenter(),s=t.getZoom(),n=t.getHeading()||0,r=t.getTilt()||0,o=t.getBounds();i&&o&&Number.isFinite(s)||console.warn("[useTrackedCameraState] at least one of the values from the map returned undefined. This is not expected to happen. Please report an issue at https://github.com/visgl/react-google-maps/issues/new"),Object.assign(e.current,{center:(null==i?void 0:i.toJSON())||{lat:0,lng:0},zoom:s||0,heading:n,tilt:r})})(t,i),e()});return()=>s.remove()},[t,e]),i}(n),{id:g,defaultBounds:p,defaultCenter:c,defaultZoom:u,defaultHeading:f,defaultTilt:m,reuseMaps:w,renderingType:y,colorScheme:x}=t,P=a(t,C),v=void 0!==t.zoom||void 0!==t.defaultZoom,b=void 0!==t.center||void 0!==t.defaultCenter;for(let t of(p||v&&b||console.warn("<Map> component is missing configuration. You have to provide zoom and center (via the `zoom`/`defaultZoom` and `center`/`defaultCenter` props) or specify the region to show using `defaultBounds`. See https://visgl.github.io/react-google-maps/docs/api-reference/components/map#required"),!P.center&&c&&(P.center=c),!P.zoom&&Number.isFinite(u)&&(P.zoom=u),!P.heading&&Number.isFinite(f)&&(P.heading=f),!P.tilt&&Number.isFinite(m)&&(P.tilt=m),Object.keys(P)))void 0===P[t]&&delete P[t];let T=(0,s.useRef)(void 0);return(0,s.useEffect)(()=>{let s,n;if(!h||!i)return;let{addMapInstance:l,removeMapInstance:c}=e,{mapId:u}=t,f=`${u||"default"}:${y||"default"}:${x||"LIGHT"}`;if(w&&I.has(f)?(s=(n=I.pop(f)).getDiv(),h.appendChild(s),n.setOptions(P),setTimeout(()=>n.setCenter(n.getCenter()),0)):((s=document.createElement("div")).style.height="100%",h.appendChild(s),n=new google.maps.Map(s,o({},P,y?{renderingType:y}:{},x?{colorScheme:x}:{}))),r(n),l(n,g),p){let{padding:t}=p,e=a(p,E);n.fitBounds(e,t)}else v&&b||n.fitBounds({east:180,west:-180,south:-90,north:90});if(T.current){let{mapId:t,cameraState:e}=T.current;t!==u&&n.setOptions(e)}return()=>{T.current={mapId:u,cameraState:d.current},s.remove(),w?I.push(f,n):google.maps.event.clearInstanceListeners(n),r(null),c(g)}},[h,i,g,t.mapId,t.renderingType,t.colorScheme]),[n,l,d]}(t,d);!function(t,e,i){let n=i.center?v(i.center):null,r=null,o=null;n&&Number.isFinite(n.lat)&&Number.isFinite(n.lng)&&(r=n.lat,o=n.lng);let a=Number.isFinite(i.zoom)?i.zoom:null,h=Number.isFinite(i.heading)?i.heading:null,l=Number.isFinite(i.tilt)?i.tilt:null;(0,s.useLayoutEffect)(()=>{if(!t)return;let i={},s=!1;null!==r&&null!==o&&(e.current.center.lat!==r||e.current.center.lng!==o)&&(i.center={lat:r,lng:o},s=!0),null!==a&&e.current.zoom!==a&&(i.zoom=a,s=!0),null!==h&&e.current.heading!==h&&(i.heading=h,s=!0),null!==l&&e.current.tilt!==l&&(i.tilt=l,s=!0),s&&t.moveCamera(i)})}(p,L,t),function(t,e){for(let i of y){let n=e[i],r=f[i];(0,s.useEffect)(()=>{if(!t||!n)return;let e=google.maps.event.addListener(t,r,e=>{n(function(t,e,i){let s={type:t,map:e,detail:{},stoppable:!1,stop:()=>{}};if(m.includes(t)){let t=e.getCenter(),i=e.getZoom(),n=e.getHeading()||0,r=e.getTilt()||0,o=e.getBounds();return t&&o&&Number.isFinite(i)||console.warn("[createEvent] at least one of the values from the map returned undefined. This is not expected to happen. Please report an issue at https://github.com/visgl/react-google-maps/issues/new"),s.detail={center:(null==t?void 0:t.toJSON())||{lat:0,lng:0},zoom:i||0,heading:n,tilt:r,bounds:(null==o?void 0:o.toJSON())||{north:90,east:180,south:-90,west:-180}},s}if(w.includes(t)){var n;if(!i)throw Error("[createEvent] mouse events must provide a srcEvent");return s.domEvent=i.domEvent,s.stoppable=!0,s.stop=()=>i.stop(),s.detail={latLng:(null==(n=i.latLng)?void 0:n.toJSON())||null,placeId:i.placeId},s}return s}(r,t,e))});return()=>e.remove()},[t,r,n])}}(p,t),function(t,e){let i={};for(let t of Object.keys(e))x.has(t)&&(i[t]=e[t]);!function(t,e){let i=(0,s.useRef)(void 0);i.current&&r(e,i.current)||(i.current=e),(0,s.useEffect)(t,i.current)}(()=>{t&&t.setOptions(i)},[i])}(p,t);let D=function(t,e){let{viewport:i,viewState:n}=e;return(0,s.useLayoutEffect)(()=>{if(!t||!n)return;let{latitude:e,longitude:i,bearing:s,pitch:r,zoom:o}=n;t.moveCamera({center:{lat:e,lng:i},heading:s,tilt:r,zoom:o+1})},[t,n]),!!i}(p,t),O=!!t.controlled;(0,s.useEffect)(()=>{if(p)return D&&p.setOptions({disableDefaultUI:!0}),(D||O)&&p.setOptions({gestureHandling:"none",keyboardShortcuts:!1}),()=>{p.setOptions({gestureHandling:t.gestureHandling,keyboardShortcuts:t.keyboardShortcuts})}},[p,D,O,t.gestureHandling,t.keyboardShortcuts]);let R=t.center?v(t.center):null,M=null,A=null;R&&Number.isFinite(R.lat)&&Number.isFinite(R.lng)&&(M=R.lat,A=R.lng);let k=(0,s.useMemo)(()=>{var e,i,s,n,r;return{center:{lat:null!=(e=M)?e:0,lng:null!=(i=A)?i:0},zoom:null!=(s=t.zoom)?s:0,heading:null!=(n=t.heading)?n:0,tilt:null!=(r=t.tilt)?r:0}},[M,A,t.zoom,t.heading,t.tilt]);(0,s.useLayoutEffect)(()=>{if(!p||!O)return;p.moveCamera(k);let t=p.addListener("bounds_changed",()=>{p.moveCamera(k)});return()=>t.remove()},[p,O,k]);let _=(0,s.useMemo)(()=>o({width:"100%",height:"100%",position:"relative",zIndex:D?-1:0},h),[h,D]),H=(0,s.useMemo)(()=>({map:p}),[p]);return g===l.AUTH_FAILURE?s.createElement("div",{style:o({position:"relative"},n?{}:_),className:n},s.createElement(b,null)):s.createElement("div",o({ref:u,"data-testid":"map",style:n?void 0:_,className:n},i?{id:i}:{}),p?s.createElement(T.Provider,{value:H},e):null)};L.deckGLViewProps=!0;let D=new Set,O=(t=null)=>{let e=(0,s.useContext)(c),{map:i}=(0,s.useContext)(T)||{};if(null===e)return!function(...t){let e=JSON.stringify(t);D.has(e)||(D.add(e),console.error(...t))}("useMap(): failed to retrieve APIProviderContext. Make sure that the <APIProvider> component exists and that the component you are calling `useMap()` from is a sibling of the <APIProvider>."),null;let{mapInstances:n}=e;return null!==t?n[t]||null:i||n.default||null};function R(t,e,i){(0,s.useEffect)(()=>{if(!t||!e||!i)return;let s=google.maps.event.addListener(t,e,i);return()=>s.remove()},[t,e,i])}function M(t,e,i){(0,s.useEffect)(()=>{t&&(t[e]=i)},[t,e,i])}function A(t,e,i){(0,s.useEffect)(()=>{if(t&&e&&i)return t.addEventListener(e,i),()=>t.removeEventListener(e,i)},[t,e,i])}let k=s.createContext(null),_={BOTTOM:["50%","100%"]},H=({children:t,styles:e,className:i,anchorPoint:n})=>{let[r,o]=null!=n?n:_.BOTTOM,a=`-${r}`,h=`-${o}`;r.trimStart().startsWith("-")&&(a=r.substring(1)),o.trimStart().startsWith("-")&&(h=o.substring(1));let l=`translate(50%, 100%) translate(${a}, ${h})`;return s.createElement("div",{style:{transform:l}},s.createElement("div",{className:i,style:e},t))};(0,s.forwardRef)((t,e)=>{let{children:i,style:r,className:o,anchorPoint:a}=t,[h,l]=function(t){let[e,i]=(0,s.useState)(null),[n,r]=(0,s.useState)(null),o=O(),a=function(t){let e=S(),i=(0,s.useContext)(c);return(0,s.useEffect)(()=>{e&&i&&i.importLibrary(t)},[e,i,t]),(null==i?void 0:i.loadedLibraries[t])||null}("marker"),{children:h,onClick:l,className:d,onMouseEnter:g,onMouseLeave:p,onDrag:u,onDragStart:f,onDragEnd:m,collisionBehavior:w,clickable:y,draggable:x,position:P,title:v,zIndex:b}=t,C=s.Children.count(h);return(0,s.useEffect)(()=>{if(!o||!a)return;let t=new a.AdvancedMarkerElement;t.map=o,i(t);let e=null;return C>0&&((e=document.createElement("div")).isCustomMarker=!0,t.content=e,r(e)),()=>{var s;t.map=null,null==(s=e)||s.remove(),i(null),r(null)}},[o,a,C]),(0,s.useEffect)(()=>{e&&e.content&&!(C>0)&&(e.content.className=d||"")},[e,d,C]),M(e,"position",P),M(e,"title",null!=v?v:""),M(e,"zIndex",b),M(e,"collisionBehavior",w),(0,s.useEffect)(()=>{e&&(void 0!==x?e.gmpDraggable=x:u||f||m?e.gmpDraggable=!0:e.gmpDraggable=!1)},[e,x,u,m,f]),(0,s.useEffect)(()=>{if(!e)return;let t=void 0!==y||!!l||!!g||!!p;e.gmpClickable=t,t&&null!=e&&e.content&&e.content.nodeType===Node.ELEMENT_NODE&&(e.content.style.pointerEvents="none",e.content.firstElementChild&&(e.content.firstElementChild.style.pointerEvents="all"))},[e,y,l,g,p]),R(e,"click",l),R(e,"drag",u),R(e,"dragstart",f),R(e,"dragend",m),A(null==e?void 0:e.element,"mouseenter",g),A(null==e?void 0:e.element,"mouseleave",p),[e,n]}(t),d=(0,s.useMemo)(()=>h?{marker:h}:null,[h]);return((0,s.useImperativeHandle)(e,()=>h,[h]),l)?s.createElement(k.Provider,{value:d},(0,n.createPortal)(s.createElement(H,{anchorPoint:a,styles:r,className:o},i),l)):null});let W=new Set(["animationIterationCount","aspectRatio","borderImageOutset","borderImageSlice","borderImageWidth","boxFlex","boxFlexGroup","boxOrdinalGroup","columnCount","columns","flex","flexGrow","flexPositive","flexShrink","flexNegative","flexOrder","gridArea","gridRow","gridRowEnd","gridRowSpan","gridRowStart","gridColumn","gridColumnEnd","gridColumnSpan","gridColumnStart","fontWeight","lineClamp","lineHeight","opacity","order","orphans","scale","tabSize","widows","zIndex","zoom","fillOpacity","floodOpacity","stopOpacity","strokeDasharray","strokeDashoffset","strokeMiterlimit","strokeOpacity","strokeWidth"]),B=["onClick","onDrag","onDragStart","onDragEnd","onMouseOver","onMouseOut"],z=(0,s.forwardRef)((t,e)=>{let i=function(t){let[e,i]=(0,s.useState)(null),n=O(),{onClick:r,onDrag:o,onDragStart:h,onDragEnd:l,onMouseOver:d,onMouseOut:g}=t,p=a(t,B),{position:c,draggable:u}=p;return(0,s.useEffect)(()=>{if(!n){void 0===n&&console.error("<Marker> has to be inside a Map component.");return}let t=new google.maps.Marker(p);return t.setMap(n),i(t),()=>{t.setMap(null),i(null)}},[n]),(0,s.useEffect)(()=>{if(!e)return;let t=google.maps.event;return r&&t.addListener(e,"click",r),o&&t.addListener(e,"drag",o),h&&t.addListener(e,"dragstart",h),l&&t.addListener(e,"dragend",l),d&&t.addListener(e,"mouseover",d),g&&t.addListener(e,"mouseout",g),e.setDraggable(!!u),()=>{t.clearInstanceListeners(e)}},[e,u,r,o,h,l,d,g]),(0,s.useEffect)(()=>{e&&p&&e.setOptions(p)},[e,p]),(0,s.useEffect)(()=>{!u&&c&&e&&e.setPosition(c)},[u,c,e]),e}(t);return(0,s.useImperativeHandle)(e,()=>i,[i]),s.createElement(s.Fragment,null)})}}]);